# 패킷 캡처 에이전트 케이스 스터디

> [English Version](packet-capture-agent-en.md)

> 두 번째 프로젝트: Mickey 1-12, 프롬프트 v2.0 → v5.0 진화

## 프로젝트 개요

| 항목 | 내용 |
|------|------|
| **목표** | 온라인 게임 TCP 패킷 캡처 → 소스코드 기반 파싱 → 재현 가능한 로그 생성 |
| **기간** | 2025-12-13 ~ 진행 중 |
| **세션 수** | Mickey 1-12 |
| **프롬프트 버전** | v2.0 → v5.0 |
| **GitHub** | [packet-capture-log-agent](https://github.com/hcsung-aws/packet-capture-log-agent) |

## 프로젝트 여정

### Phase 1: 기반 구축 (Mickey 1-4)

| Mickey | 주요 작업 | 결과 |
|--------|----------|------|
| 1 | 요구사항 분석, 기술 스택 결정 | C# .NET 9 선택, 제안서 작성 |
| 2 | Raw Socket 캡처, 동적 프로토콜 파싱 | EchoClient 테스트 성공 |
| 3 | 패킷 재현 기능, 실제 게임 조사 | 대부분 게임 암호화 사용 확인 |
| 4 | XTEA/RSA 복호화 파이프라인 | Transform 파이프라인 설계 |

**이 단계의 교훈:**
- MemoryStream Position 관리 주의
- 대부분의 실제 게임은 암호화 사용 → 테스트 환경 필요

### Phase 2: 테스트 환경 구축 시도 (Mickey 5-7)

| Mickey | 주요 작업 | 결과 |
|--------|----------|------|
| 5 | (짧은 세션) | - |
| 6 | Forgotten Server 빌드 환경 | vcpkg 경로/버전 문제 |
| 7 | vcpkg 버그 해결, **방향 전환** | 자체 시뮬레이터 결정 ⭐ |

**Mickey 7의 핵심 결정:**

```
목적: 패킷 캡처 테스트
시도: Forgotten Server 설정 (3일 소요)
문제: vcpkg 버그, 프로토콜 버전, 포트 문제...
결정: 자체 시뮬레이터 개발로 전환
결과: 1.5일 만에 완성
```

**이 단계에서 추가된 원칙:**
- 목적 우선: 작업 전 최종 목적 명확화
- 단순함 우선: 복잡한 솔루션보다 단순한 대안 먼저
- 조기 방향 전환: 복잡도가 과도하면 대안 제안

### Phase 3: 시뮬레이터 개발 (Mickey 8-12)

| Mickey | 주요 작업 | 결과 |
|--------|----------|------|
| 8 | MMORPG 시뮬레이터 구현 | Boost.Asio 서버, 멀티플레이어 |
| 9 | DB 연동, 프로토콜 자동 생성 | MySQL ODBC, GitHub 업로드 |
| 10 | 패킷 재현 테스트, 캐릭터 시스템 | 구조체 패킹 문제 해결 |
| 11 | 빌드 환경 정리, 프로토콜 동기화 | vcpkg 비활성화 |
| 12 | (현재) | - |

**Mickey 8의 핵심 실패와 교훈:**

1. **버퍼 소유권 문제**
   ```
   증상: 캐릭터 좌표 워프, 입력 불가
   원인: 외부 ParsePacket에서 버퍼 수정
   해결: Session 내부에서 버퍼 관리
   ```

2. **중첩 락 데드락**
   ```
   증상: abort() 발생
   원인: ForEach(lock) → Handler → Broadcast(lock)
   해결: std::recursive_mutex 사용
   ```

3. **브로드캐스트 누락**
   ```
   증상: 플레이어 퇴장 시 다른 클라이언트에 반영 안 됨
   원인: SC_CHAR_LEAVE 패킷 전송 누락
   해결: 상태 변경 시 브로드캐스트 체크리스트 추가
   ```

**이 단계에서 추가된 체크리스트:**
- 비동기/콜백 패턴 체크리스트
- 멀티플레이어 상태 동기화 체크리스트
- Windows 빌드 체크리스트

## 프롬프트 진화 타임라인

```
Mickey 1-6: v2.0 프롬프트 사용
  │
  ├─ Mickey 7 실패: 목적 상실, 복잡도 과다
  │   └─ 추가: 목적 우선, 단순함 우선, 도구 선택 체크리스트
  │
  ├─ Mickey 8 실패: 버퍼 소유권, 데드락, 브로드캐스트
  │   └─ 추가: 비동기 체크리스트, 멀티플레이어 체크리스트
  │
  ├─ Mickey 9 실패: MSVC 한글, JSON 타입
  │   └─ 추가: MSVC 주의사항, JSON 스키마 확인, 세션 종료 프로토콜
  │
Mickey 10-12: v5.0 프롬프트 사용
```

## Godot 프로젝트와의 비교

| 항목 | Godot 리플레이 (v2.0) | 패킷 캡처 (v5.0) |
|------|----------------------|------------------|
| 환경 | 단일 (Godot) | 크로스 플랫폼 (WSL + Windows) |
| 복잡도 | 중간 | 높음 |
| 세션 수 | 6 | 12 |
| 주요 도전 | 프레임 동기화, 테스트 자동화 | 네트워크, DB, 빌드 시스템 |
| 프롬프트 변화 | 기본 패턴 확립 | 체크리스트, 자동화 추가 |

## 핵심 교훈

### 1. 목적을 잃지 마라

```
나쁜 예: "Forgotten Server를 설정해줘"
좋은 예: "패킷 캡처 테스트가 목적이야. 가장 단순한 방법을 먼저 분석해줘"
```

### 2. 일반 지침보다 구체적 체크리스트

```
나쁜 예: "비동기 코드 주의해"
좋은 예: "버퍼 소유권, 락 재진입, 객체 생명주기 확인해"
```

### 3. 실패를 체계화하라

```markdown
### Lesson N: [주제]
- 문제: [무엇이 잘못되었는가]
- 원인: [왜 잘못되었는가]
- 해결: [어떻게 해결했는가]
- 교훈: [다음에 무엇을 피해야 하는가]
```

## 관련 문서

- [프롬프트 진화 가이드](../06-prompt-evolution.md) - v2.0 → v5.0 상세 분석
- [Mickey 7-12 세션 로그](../../sessions/packet-capture/) - 실제 작업 기록
- [시스템 프롬프트 v5.0](../../examples/ai-developer-mickey.json) - 전체 프롬프트

---

*이 문서는 프로젝트 진행 중이며, 완료 후 업데이트될 예정입니다.*
